!function(t){"use strict";t(document).ready(function(){function e(){jQuery(".woocommerce_tm_epo").each(function(t,e){var i=jQuery(e),a=i.find(".tmcp_attribute").val();i.find("select.tmcp_att").hide(),i.find("select.tmcp_att[data-tm-attr='"+a+"']").show();var c=i.find("select.tmcp_att").val(),_=i.find("select.tmcp-variation").val(),n="input.tmcp-price-input-variation-"+_+"[data-price-input-attribute='"+c+"'],select.tmcp-price-input-variation-"+_+"[data-price-input-attribute='"+c+"']";i.find("input.tmcp-price-input").hide(),i.find("select.tmcp-price-input-type").hide(),i.find(n).show(),o(i.find("select.tmcp-variation"),"variation")}),jQuery("input#_downloadable").trigger("change")}function o(t,e){var o=t.val(),i=t.closest(".woocommerce_tm_epo");i.find("input.tmcp-price-input").hide(),i.find("select.tmcp-price-input-type").hide();var a=i.find("input.tmcp_loop").val(),c=i.find("select.tmcp_att").val(),_=i.find("select.tmcp-variation").val(),n="";switch(e){case"variation":_=o,n="input.tmcp-price-input-variation-"+o+"[data-price-input-attribute='"+c+"'],select.tmcp-price-input-variation-"+o+"[data-price-input-attribute='"+c+"']";break;case"attribute":c=o,n="input.tmcp-price-input-variation-"+_+"[data-price-input-attribute='"+o+"'],select.tmcp-price-input-variation-"+_+"[data-price-input-attribute='"+o+"']"}i.find(n).length<=0&&(i.find(".tmcp_pricing").append('<input type="text" size="5" name="tmcp_regular_price['+a+"]["+c+"]["+_+']" value="" class="wc_input_price tmcp-price-input tmcp-price-input-variation-'+_+'" data-price-input-attribute="'+c+'" />'),i.find(".tmcp_pricing").append('<select class="tmcp-price-input-type tmcp-price-input tmcp-price-input-variation-'+_+'" data-price-input-attribute="'+c+'" name="tmcp_regular_price_type['+a+"]["+c+"]["+_+']"><option value="">'+tm_epo_admin_meta_boxes.i18n_fixed_type+'</option><option value="percent">'+tm_epo_admin_meta_boxes.i18n_percent_type+"</option></select>")),i.find(n).show()}function i(){t(".woocommerce_tm_epos .woocommerce_tm_epo").each(function(e,o){t(".tm_epo_menu_order",o).val(parseInt(t(o).index(".woocommerce_tm_epos .woocommerce_tm_epo"),10))})}function a(){if(1==_){t("#tm_extra_product_options").block({message:null,overlayCSS:{background:"#fff url("+tm_epo_admin_meta_boxes.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}});var o={action:"woocommerce_tm_load_epos",post_id:tm_epo_admin_meta_boxes.post_id,security:tm_epo_admin_meta_boxes.load_tm_epo_nonce};t.post(tm_epo_admin_meta_boxes.ajax_url,o,function(o){t(".tm_mode_local").html(o),t("#tm_extra_product_options").unblock(),t("#tm_extra_product_options").trigger("woocommerce_tm_epos_loaded"),_=0,e()})}}function c(e){e&&(t("#tm_meta_cpf_mode").val(e),t(".tm_mode_selector").addClass("tm_hidden"),t(".tm_mode_builder,.tm_mode_local,.tm_mode_settings").hide(),t(".tm_mode_"+e).show(),t(".tm_builder_select,.tm_local_select,.tm_settings_select").removeClass("button-primary"),t(".tm_"+e+"_select").addClass("button-primary"))}var _=0,n={items:".woocommerce_tm_epo",cursor:"move",axis:"y",handle:"h3 .move",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),i()}};e(),t("#tm_extra_product_options").on("change","select.tmcp-variation",function(e){o(t(this),"variation")}),t("#tm_extra_product_options").on("change","select.tmcp_att",function(e){o(t(this),"attribute")}),t("#tm_extra_product_options").on("woocommerce_tm_epo_added",function(){t(".woocommerce_tm_epos").sortable(n)}),t("#tm_extra_product_options").on("woocommerce_tm_epos_loaded",function(){t(".woocommerce_tm_epos").sortable(n)}),t(".woocommerce_tm_epos").sortable(n),t("#variable_product_options").on("click","button.remove_variation",function(t){_=1}),t("#variable_product_options").on("woocommerce_variations_added",function(){_=1}),t(".product_attributes").on("click","button.add_new_attribute",function(){_=1}),t(".save_attributes").on("click",function(){_=1}),t(".tm_epo_class a").on("click",function(){a()}),t("#tm_extra_product_options").on("click","button.tm_add_epo",function(){var o,i=t("select.tmcp_attr_list").val();try{o=t(".woocommerce_tm_epos .woocommerce_tm_epo[data-epo-attr='"+i+"']")}catch(e){o=t()}{if(!(o.length>0)){t(".tm_mode_local").block({message:null,overlayCSS:{background:"#fff url("+tm_epo_admin_meta_boxes.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}});var a=t(".woocommerce_tm_epo").length,c={action:"woocommerce_tm_add_epo",post_id:tm_epo_admin_meta_boxes.post_id,att_id:i,loop:a,security:tm_epo_admin_meta_boxes.add_tm_epo_nonce};return t.post(tm_epo_admin_meta_boxes.ajax_url,c,function(o){"max"==o?(alert(tm_epo_admin_meta_boxes.i18n_max_tmcp),t(".tm_mode_local").unblock()):0==o||(t(".woocommerce_tm_epos").append(o),t("#tm_extra_product_options").trigger("woocommerce_tm_epo_added"),e())}).always(function(e){t(".tm_mode_local").unblock()}),!1}o.find(".woocommerce_tmcp_attributes").show()}}),t("#tm_extra_product_options").on("click",".remove_tm_epo",function(e){if(e.preventDefault(),window.confirm(tm_epo_admin_meta_boxes.i18n_remove_tmcp)){var o=t(this).parent().parent(),i=t(this).attr("rel");if(i>0){t(o).block({message:null,overlayCSS:{background:"#fff url("+tm_epo_admin_meta_boxes.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}});var a={action:"woocommerce_tm_remove_epo",tmcpid:i,security:tm_epo_admin_meta_boxes.delete_tm_epo_nonce};t.post(tm_epo_admin_meta_boxes.ajax_url,a,function(e){t(o).fadeOut("300",function(){t(o).remove()})})}else t(o).fadeOut("300",function(){t(o).remove()})}return!1}),t("#tm_extra_product_options").on("change",".tm-type",function(e){var o=t(this),i=o.closest(".data").find(".tmcp_choices");"checkbox"==o.val()?i.removeClass("tm-hidden"):i.addClass("tm-hidden")}),t("#tm_extra_product_options").on("click",".tm_select_mode",function(e){e.preventDefault();var o="local";t(this).is(".tm_builder_select")&&(o="builder"),t(this).is(".tm_settings_select")&&(o="settings"),c(o)}),t("#tm_meta_cpf_mode").val()||t("#tm_meta_cpf_mode").val("builder"),c(t("#tm_meta_cpf_mode").val()),t("#woocommerce-order-items").on("click.tc","a.tm-delete-order-item",function(e){e.preventDefault();var o=t(this).closest("tr.item, tr.fee, tr.shipping"),i=o.attr("data-tm_item_id"),a=o.attr("data-tm_key_id");i=t("<input type='hidden' class='tm_meta_serialized' name='tm_item_id' />").val(i),a=t("<input type='hidden' class='tm_meta_serialized' name='tm_key' />").val(a),o.prepend(i).prepend(a),t(".button.calculate-action").trigger("click")})})}(jQuery);